# Как генерируется ответ ученика

```
  ШАГ 1 — Выбор намерения (интента)
  ┌────────────────────────────────────────┐
  │  Режим "случайный":                    │
  │    кубик по весам → намерение           │
  │                                        │
  │  Режим "LLM-классификатор":            │
  │    отдельный вызов LLM                 │
  │    анализирует контекст диалога        │
  │    → выбирает подходящее намерение     │
  │    → не смог? fallback на случайный    │
  └──────────────┬─────────────────────────┘
                 ▼
  ШАГ 2 — Сборка промпта
  ┌────────────────────────────────────────┐
  │                                        │
  │  ЧТО делать:  промпт намерения         │
  │  ┌─ если "ответить":                   │
  │  │   бросок кубика (вероятность %)     │
  │  │   ├─ повезло  → ответь правильно   │
  │  │   └─ не повезло → допусти ошибку   │
  │  │                                     │
  │  ─────────── разделитель ──────────    │
  │                                        │
  │  КТО ученик:  промпт типа ученика     │
  │    (слабый / средний / сильный)        │
  └──────────────┬─────────────────────────┘
                 ▼
  ШАГ 3 — Генерация
  ┌────────────────────────────────────────┐
  │  Вызов LLM с собранным промптом       │
  │  + зеркальная история                 │
  │    (реплики учителя = "собеседник",    │
  │     реплики ученика = "я")             │
  └──────────────┬─────────────────────────┘
                 ▼
        ответ + рассуждения модели
        + плашка "Намерение: answer"
```

## Намерения (интенты)

Каждый ход ученик делает одно из 10 действий:

| Намерение | Что делает | Вес по умолчанию |
|-----------|-----------|:---:|
| **answer** | Отвечает на вопрос учителя (правильно или с ошибкой) | 58% |
| **set-problem** | Приносит задачу или тему | 14% |
| **agree-with-tutor** | Соглашается с планом или объяснением | 12% |
| **chat** | Болтает не по теме, отвлекается | 5% |
| **get-explanation** | Просит объяснить или спрашивает "почему?" | 4% |
| **criticize-tutor** | Критикует или ругает учителя | 3% |
| **get-solution** | Просит дать готовый ответ | 2% |
| **find-mistake** | Указывает на ошибку учителя | 1% |
| **end-dialog** | Хочет закончить диалог | 1% |
| **thank-tutor** | Благодарит | 0% |

Веса = вероятности в случайном режиме и ориентир для LLM-классификатора.
Настраиваются в сайдбаре, сумма должна быть 100%.

## Особое намерение: "ответить"

Когда выпадает **answer**, бросается ещё один кубик — вероятность правильного ответа:
- Слабый ученик: 20%
- Средний: 50%
- Сильный: 80%

При неправильном ответе ученик использует одну из ошибок по таксономии CogTutor:
вычислительная, концептуальная, невнимательность, неверная стратегия, алгебраическая, регрессия.

## Типы учеников

| Тип | Характер | Длина ответа |
|-----|---------|:---:|
| **Слабый** | Ленивый, неуверенный, легко сдаётся, грубит | 1-5 слов |
| **Средний** | Старательный, но путается, просит помощь | 3-15 слов |
| **Сильный** | Уверенный, лаконичный, замечает ошибки учителя | 3-15 слов |

Тип задаёт КТО ученик (стиль, характер). Намерение задаёт ЧТО делать на этом ходу.

## Настройки из сайдбара

- **Тип ученика** — слабый / средний / сильный
- **Вероятность правильного ответа** — ползунок 0-100%
- **Режим выбора намерения** — случайный по весам или LLM-классификатор
- **Веса намерений** — ползунки для каждого из 10 интентов
- **Модель, thinking/reasoning, temperature, max tokens**
